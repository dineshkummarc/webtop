(function(d,c,e){var b=(function(){var i=[],l=0,m=1,n=c.document,h="px",g=25,j=1,k=2;function f(p){var o=i[p];return{close:function(){if(o){n.body.removeChild(o.node);delete i[p];l--}},maximize:function(){if(o.state!==k){d(o.node).css({width:"100%",height:"100%",left:"0px",top:"0px"});d("div.window-inner",o.node).css({height:"100%",width:"100%"});o.state=k;o.node.style.zIndex=l++;d(o.node).draggable("option","disabled",true).resizable("option","disabled",true)}else{this.restore();d(o.node).draggable("option","disabled",false).resizable("option","disabled",false)}},minimize:function(){d(o.node).hide("fast");o.state*=-1},focus:function(){d(o.node).show("fast");o.node.style.zIndex=l++},restore:function(){this.focus();if(o.state===k){d(o.node).css({width:o.dim.w,height:o.dim.h+h,left:o.dim.x+h,top:o.dim.y+h});var q=d("div.window-inner",o.node),r=q.hasClass("full")?0:g;q.css({width:o.dim.w,height:o.dim.h-r+h});o.state=j}o.state=Math.abs(o.state)},props:{x:o.dim.x,y:o.dim.y,w:o.dim.w,h:o.dim.h,state:o.state}}}return{run:function(o){var u=n.createElement("div"),y=APPLIST[o],v=i.length;if(y.single){var x=this.api.findTask(o);if(x){f(x[0]).restore();return}}u.id="app"+v;d(u).addClass("window").css({width:y.width,height:y.height+h,zIndex:(y.alwaysOntop?1000:l++)}).html(div({"class":"window-header"},strong(y.title),span(a({"class":"min"},"[-]"),a({"class":"max"},"[_]"),a({"class":"close"},"[x]")))+div({"class":"window-inner loading"}));if(y.css){d(u).css(y.css)}i.push({id:o,node:u,dim:{w:y.width,h:y.height,x:10,y:10},state:j});var t=n.createElement("iframe"),z=d("div.window-inner",u);d(t).attr({frameBorder:"0",allowTransparency:"true",src:"app.php?id="+o+(new Date()).getTime()}).hide();t.src="http://sketch.processing.org/";z.append(t).css("height",y.height-g+h);if(y.header===false){d("div.window-header",u).addClass("hidden");z.addClass("full").css("height",y.height)}n.body.appendChild(u);var w=f(i.length-1);d("a.min",u).click(function(){w.minimize()});d("a.max",u).click(function(){w.maximize()});d("a.close",u).click(function(){w.close()});var p=t.contentWindow||t.contentDocument.defaultView;p.Webtop=b;p.App=w;d(t).load(function(){z.removeClass("loading");d(t).show()});var s=function(A){A.preventDefault()},r=function(A){d("iframe",A).hide();d(A).addClass("drag")},q=function(A){d("iframe",A).show();d(A).removeClass("drag")};d("div.window-header",u).bind("dragstart",s).bind("selectstart",s).bind("mousedown",function(){w.focus()}).dblclick(function(){w.maximize()});if(y.draggable!==false){d(u).draggable({handle:"div.window-header",scroll:false,containment:"document",start:function(){r(this)},stop:function(){q(this);i[v].dim.x=parseInt(d(this).css("left"),10);i[v].dim.y=parseInt(d(this).css("top"),10)}})}if(y.resizable!==false){d(u).resizable({containment:"document",autoHide:true,alsoResize:z,start:function(){r(this);if(i[v].state===k){w.maximize()}},stop:function(){q(this);i[v].dim.w=d(this).css("width");i[v].dim.h=parseInt(d(this).css("height"),10)}})}},api:{findTask:function(r){var q=[],p=0,o;for(o=i.length;p<o;p++){if(i[p]&&i[p].id===r){q.push(p)}}return q.length>0?q:false},getTasks:function(){return i}}}})();c.Webtop=b})(jQuery,window);